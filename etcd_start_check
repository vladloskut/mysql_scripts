{
systemctl daemon-reload
systemctl enable etcd
systemctl start etcd
systemctl -l status etcd --no-pager
ss -tunelp | grep 2379
}

etcdctl --write-out=table --endpoints={MEMBER_1_IP}:2379,{MEMBER_2_IP}:2379,{MEMBER_3_IP}:2379 endpoint status


etcdctl --endpoints={MEMBER_1_IP}:2379,{MEMBER_2_IP}:2379,{MEMBER_3_IP}:2379 endpoint health

{
iptables --append INPUT --protocol tcp --source {MEMBER_1_IP} --jump ACCEPT
iptables --append INPUT --protocol tcp --source {MEMBER_2_IP} --jump ACCEPT
iptables --append INPUT --protocol tcp --source {MEMBER_3_IP} --jump ACCEPT
}
{
iptables -A INPUT -p tcp --dport 2379 -j ACCEPT
iptables -A INPUT -p tcp --dport 8008 -j ACCEPT
iptables -A INPUT -p tcp --dport 5432 -j ACCEPT
iptables -A INPUT -p tcp --dport 6432 -j ACCEPT
iptables -A INPUT -p tcp --dport 2380 -j ACCEPT
}
iptables-save


{
echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list;
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -;
apt-get update; apt-get install -y --allow-unauthenticated postgresql-14 postgresql-client-14 pgbouncer pgbadger postgresql-14-repack;
apt list --installed | grep postg;
apt-get clean;
mkdir /home/postgres/;
chown postgres:postgres /home/postgres/;
ls -ld /home/postgres/;
mv -v /etc/logrotate.d/postgresql-common /tmp;
}

sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
sudo dnf -qy module disable postgresql
sudo dnf install -y postgresql14-server
sudo /usr/pgsql-14/bin/postgresql-14-setup initdb
sudo systemctl enable postgresql-14
sudo systemctl start postgresql-14
